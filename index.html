<!DOCTYPE html>

<html class="dark" lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>My Wallet</title>
  <link rel="icon" type="image/x-icon" href="./icons.png">
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&amp;display=swap"
    rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap"
    rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet" />
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.15/jquery.mask.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
  <!-- <script src="https://d3js.org/d3.v7.min.js""></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.js"
    integrity="sha512-iiZOijMkLFQSa43AyuzD6p176GJlnhWXEv7loEZFkCDpFQvZCijZLE6U8IRpAIb53KagIIwhSwHWTgsDlci/jw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#137fec",
            "background-light": "#f6f7f8",
            "background-dark": "#0b0f19",
            "card-dark": "#1a2131",
            "accent-blue": "#3b82f6",
            "accent-purple": "#8b5cf6",
            "accent-teal": "#00c49a",
            "accent-yellow": "#eab308",
            "loss-red": "#ff4d4d",
            "text-light": "#f1f5f9",
            "text-muted": "#94a3b8"
          },
          fontFamily: {
            "display": ["Inter", "sans-serif"]
          },
          borderRadius: {
            "DEFAULT": "0.25rem",
            "lg": "0.5rem",
            "xl": "0.75rem",
            "full": "9999px"
          },
        },
      },
    }
  </script>
  <style>
    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }

    body {
      font-family: 'Inter', sans-serif;
      -webkit-tap-highlight-color: transparent;
    }

    .glass-card {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .donut-gradient {
      background: conic-gradient(#3b82f6 0deg 90deg,
          #8b5cf6 90deg 160deg,
          #f97316 160deg 280deg,
          #10b981 280deg 360deg);
    }

    .progress-glow {
      box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
    }

    .nav-active {
      color: #10b981;
      text-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
    }
  </style>
</head>

<body>
  <div
    class="relative flex h-auto min-h-screen w-full flex-col bg-background-light dark:bg-background-dark group/design-root overflow-x-hidden font-display">
    <div class="layout-container flex h-full grow flex-col">
      <div class="px-4 md:px-10 flex flex-1 justify-center py-5">
        <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
          <header
            class="flex items-center justify-between whitespace-nowrap border-b border-solid border-gray-200 dark:border-b-[#283039] px-4 md:px-10 py-3">
            <div class="flex items-center gap-4 text-black dark:text-white">
              <div class="size-6">
                <span class="material-symbols-outlined">
                  wallet
                </span>
              </div>
              <h2 class="text-black dark:text-white text-xl font-bold leading-tight tracking-[-0.015em]">
                Hesaplarım</h2>
            </div>
            <div class="flex flex-1 justify-end gap-4">
              <button onclick="location.href='./fundinfo.html';"
                class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 w-10 bg-gray-200 dark:bg-[#283039] text-black dark:text-white gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0">
                <span class="material-symbols-outlined">
                  add_notes
                </span>
              </button>
              <button onclick="get_all_info()"
                class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 w-10 bg-gray-200 dark:bg-[#283039] text-black dark:text-white gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0">
                <span class="material-symbols-outlined">
                  notifications
                </span>
              </button>
              <button onclick="showPortfolioSlider()"
                class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 w-10 bg-accent-teal text-white gap-2 text-sm font-bold shadow-lg hover:scale-105 transition-transform">
                <span class="material-symbols-outlined">
                  account_balance_wallet
                </span>
              </button>
              <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10"
                onclick="location.href='portfoy.html';" data-alt="User avatar"
                style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCSZpcCc0dT1DhdDQKWT81EXGWi8rqUgI_SFnF_0Rh_YB0Qz5T5RW2IesH2nfPiSWZLHRYUthzsWMpwMWjCj1rRIBC3Pytm81Bh0zHG0LhevSnzTMcTnE32gr2EvkrGc2MBay3WSjRr3q-Uf3d6LfIMJupEKKwHyKIqurfwvF0vYemYGojnBvxEwsl2hRtUxSVNjXvT7vkgzsO4vCjEDyiC90b4V_F0MZvtJ5ivqDZu-slU3Dza1g4FGErpS9xOd8vorVv_75MEtEc6");'>
              </div>
            </div>
          </header>
          <main class="flex flex-col">
            <div class="flex items-center justify-center p-4">
              <div class="relative flex items-center justify-center w-52 h-52">
                <svg id="donut-chart" class="w-full h-full transform -rotate-90" viewBox="0 0 36 36"></svg>
                <div class="absolute flex flex-col items-center justify-center" id="donut-center">
                  <p class="text-zinc-600 dark:text-zinc-400 text-sm font-medium">Toplam Varlık</p>
                  <p id="donut-total" class="text-zinc-900 dark:text-white text-2xl font-bold tracking-tight">₺0</p>
                </div>
              </div>
            </div>
            <div class="bg-card-dark p-5 rounded-2xl shadow-lg border border-white/5">
              <div class="flex justify-between items-end mb-3">
                <div class="flex flex-col">
                  <span class="text-[10px] font-bold text-text-muted uppercase tracking-widest">Hedef</span>
                  <span class="text-lg font-bold text-white" id="total_hedef">₺1000</span>
                </div>
                <div class="text-right">
                  <span class="text-sm font-bold text-accent-teal" id="kalan_hedef_yuzde">68.7%</span>
                </div>
              </div>
              <div class="w-full h-3 bg-slate-800 rounded-full overflow-hidden">
                <div
                  class="h-full bg-gradient-to-r from-accent-teal via-accent-blue to-accent-purple rounded-full shadow-[0_0_10px_rgba(0,196,154,0.3)]"
                  style="width: 68.7%"></div>
              </div>
              <p class="text-[11px] text-text-muted mt-3 text-center">Hedefe ulaşmak için <span
                  class="text-text-light font-medium" id="kalan_hedef_tl">₺313,4</span> kaldı</p>
            </div><br>
            <div class="flex min-w-[158px] flex-1 gap-2 rounded-xl">
              <div class="flex-1 flex flex-col gap-2 rounded-l-xl p-4 bg-card-dark">
                <p class="text-zinc-600 dark:text-zinc-400 text-sm font-medium leading-normal">Toplam Kâr/Zarar</p>
                <p id="kar_zarar" class="text-green-500 tracking-tight text-2xl font-bold leading-tight">%0.00</p>
              </div>
              <div class="flex-1 flex flex-col gap-2 rounded-r-xl p-4 bg-card-dark">
                <p class="text-zinc-600 dark:text-zinc-400 text-sm font-medium leading-normal">Günlük Kâr/Zarar</p>
                <p class="tracking-tight text-2xl font-bold leading-tight"> <span id="gunluk_kar_zarar"
                    class="text-green-500"> %0.00 </span><br> <span id="gunluk_kar_zarar_amount"
                    class="text-sm text-zinc-600 dark:text-zinc-400 ml-2">₺ 0.00</span> </p>
              </div>
            </div>
            <br>
            <div class="flex gap-4">
              <div class="flex-1 flex min-w-[158px] flex-col gap-2 rounded-l-xl p-4 bg-card-dark">
                <p class="text-zinc-600 dark:text-zinc-400 text-sm font-medium leading-normal">Aylık Borç</p>
                <p class="text-red-500 tracking-tight text-2xl font-bold leading-tight" id="toplam_borc">₺0</p>
              </div>
              <div class="flex-1 flex min-w-[158px] flex-col gap-2 rounded-r-xl p-4 bg-card-dark">
                <p class="text-zinc-600 dark:text-zinc-400 text-sm font-medium leading-normal">Aylık Gider</p>
                <p class="text-red-500 tracking-tight text-2xl font-bold leading-tight" id="toplam_harcama">₺0</p>
              </div>
            </div>
            <br>
            <div class="flex flex-col gap-4">
              <div class="glass-card p-5 rounded-3xl border-l-4 border-primary">
                <div class="flex w-full items-start justify-between">
                  <p class="line-clamp-1 text-base font-medium leading-normal text-black dark:text-white"
                    id="staff-1-name">Bank of America</p>
                </div>
                <div class="flex w-full flex-wrap items-center justify-between gap-4">
                  <div class="relative grow sm:max-w-xs">
                    <span
                      class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 text-base">
                      currency_lira </span>
                    <input
                      class="w-full rounded-md border-gray-300 bg-white py-2 pl-8 pr-2 text-sm text-black placeholder-gray-400 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-500"
                      placeholder="Amount" type="number" id="staff-1" />
                  </div>
                </div>
              </div>
              <div class="glass-card p-5 rounded-3xl border-l-4 border-primary">
                <div class="flex w-full items-start justify-between">
                  <p class="line-clamp-1 text-base font-medium leading-normal text-black dark:text-white"
                    id="staff-2-name">Bank of America</p>
                </div>
                <div class="flex w-full flex-wrap items-center justify-between gap-4">
                  <div class="relative grow sm:max-w-xs">
                    <span
                      class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 text-base">
                      currency_lira </span>
                    <input
                      class="w-full rounded-md border-gray-300 bg-white py-2 pl-8 pr-2 text-sm text-black placeholder-gray-400 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-500"
                      placeholder="Amount" type="number" id="staff-2" />
                  </div>
                </div>
              </div>
              <div class="glass-card p-5 rounded-3xl border-l-4 border-primary">
                <div class="flex w-full items-start justify-between">
                  <p class="line-clamp-1 text-base font-medium leading-normal text-black dark:text-white"
                    id="staff-3-name">Bank of America</p>
                </div>
                <div class="flex w-full flex-wrap items-center justify-between gap-4">
                  <div class="relative grow sm:max-w-xs">
                    <span
                      class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 text-base">
                      currency_lira </span>
                    <input
                      class="w-full rounded-md border-gray-300 bg-white py-2 pl-8 pr-2 text-sm text-black placeholder-gray-400 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-500"
                      placeholder="Amount" type="number" id="staff-3" />
                  </div>
                </div>
              </div>
              <div class="glass-card p-5 rounded-3xl border-l-4 border-primary">
                <div class="flex w-full items-start justify-between">
                  <p class="line-clamp-1 text-base font-medium leading-normal text-black dark:text-white"
                    id="staff-4-name">Bank of America</p>
                </div>
                <div class="flex w-full flex-wrap items-center justify-between gap-4">
                  <div class="relative grow sm:max-w-xs">
                    <span
                      class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 text-base">
                      currency_lira </span>
                    <input
                      class="w-full rounded-md border-gray-300 bg-white py-2 pl-8 pr-2 text-sm text-black placeholder-gray-400 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-500"
                      placeholder="Amount" type="number" id="staff-4" />
                  </div>
                </div>
              </div>
              <div class="glass-card p-5 rounded-3xl border-l-4 border-primary">
                <div class="flex w-full items-start justify-between">
                  <p class="line-clamp-1 text-base font-medium leading-normal text-black dark:text-white"
                    id="staff-5-name">Bank of America</p>
                </div>
                <div class="flex w-full flex-wrap items-center justify-between gap-4">
                  <div class="relative grow sm:max-w-xs">
                    <span
                      class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 text-base">
                      currency_lira </span>
                    <input
                      class="w-full rounded-md border-gray-300 bg-white py-2 pl-8 pr-2 text-sm text-black placeholder-gray-400 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-500"
                      placeholder="Amount" type="number" id="staff-5" />
                  </div>
                </div>
              </div>
              <div class="glass-card p-5 rounded-3xl border-l-4 border-primary">
                <div class="flex w-full items-start justify-between">
                  <p class="line-clamp-1 text-base font-medium leading-normal text-black dark:text-white"
                    id="staff-6-name">Bank of America</p>
                </div>
                <div class="flex w-full flex-wrap items-center justify-between gap-4">
                  <div class="relative grow sm:max-w-xs">
                    <span
                      class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 text-base">
                      currency_lira </span>
                    <input
                      class="w-full rounded-md border-gray-300 bg-white py-2 pl-8 pr-2 text-sm text-black placeholder-gray-400 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-500"
                      placeholder="Amount" type="number" id="staff-6" />
                  </div>
                </div>
              </div>
              <div class="glass-card p-5 rounded-3xl border-l-4 border-primary">
                <div class="flex w-full items-start justify-between">
                  <p class="line-clamp-1 text-base font-medium leading-normal text-black dark:text-white"
                    id="staff-7-name">Bank of America</p>
                </div>
                <div class="flex w-full flex-wrap items-center justify-between gap-4">
                  <div class="relative grow sm:max-w-xs">
                    <span
                      class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 text-base">
                      currency_lira </span>
                    <input
                      class="w-full rounded-md border-gray-300 bg-white py-2 pl-8 pr-2 text-sm text-black placeholder-gray-400 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-500"
                      placeholder="Amount" type="number" id="staff-7" />
                  </div>
                </div>
              </div>
            </div>
            <div
              class="mt-8 border-t border-gray-200 bg-background-light p-4 dark:border-[#283039] dark:bg-background-dark">
              <div id="chartContainer" style="height: 370px; width: 100%;"></div>
            </div>
          </main>
        </div>
      </div>
    </div>
  </div>
  <nav
    class="fixed bottom-0 left-0 right-0 bg-white/80 dark:bg-card-dark/80 backdrop-blur-xl border-t border-slate-200 dark:border-slate-800 px-4 pb-8 pt-3 z-50">
    <div class="max-w-md mx-auto flex items-center justify-between">
      <a class="flex flex-col items-center gap-1 nav-active transition-all" href="#donut-total" onclick="calculate()">
        <span class="material-icons-round">calculate</span>
        <span class="text-[10px] font-medium">Hesapla</span>
      </a>
      <a class="flex flex-col items-center gap-1 text-slate-400 hover:text-primary transition-all"
        onclick="lineGraph()">
        <span class="material-icons-round">analytics</span>
        <span class="text-[10px] font-medium">Grafik</span>
      </a>
      <a class="flex flex-col items-center gap-1 text-slate-400 hover:text-primary transition-all"
        href="#chartContainer" onclick="barGraph()">
        <span class="material-icons-round">pie_chart</span>
        <span class="text-[10px] font-medium">Dağılım</span>
      </a>
      <a class="flex flex-col items-center gap-1 text-slate-400 hover:text-primary transition-all" href="./debit.html">
        <span class="material-icons-round">payments</span>
        <span class="text-[10px] font-medium">Borçlar</span>
      </a>
      <a class="flex flex-col items-center gap-1 text-slate-400 hover:text-primary transition-all"
        href="./expenses.html">
        <span class="material-icons-round">receipt_long</span>
        <span class="text-[10px] font-medium">Giderler</span>
      </a>
    </div>
  </nav>
</body>
<script type="text/javascript" src="./script.js"></script>
<script type="text/javascript" src="./Line_Chart.js"></script>
<script type="text/javascript" src="./day_date_graph.js"></script>
<script type="text/javascript" src="./bar_graph.js"></script>
<script src="./edit_labels.js"></script>

<!-- <script type="text/javascript" src="./fetch_data.js"></script>-->
<script>
  calculate()
  lineGraph()
  const STAFF_COLORS = [
    "#3B82F6", // blue
    "#8B5CF6", // purple
    "#FACC15", // yellow
    "#F97316", // orange
    "#14B8A6"  // teal
  ];
  const NEGATIVE_COLOR = "#EF4444"; // Kırmızı!

  // Test amaçlı localStorage yoksa ekleyelim
  if (!localStorage.getItem("values")) {
    localStorage.setItem(
      "values",
      JSON.stringify({
        "staff_1": 103.8,
        "staff_2": 226.7,
        "staff_3": 54.2,
        "staff_4": 132.8,
        "staff_5": -33.7,
        "staff_6": -10.2,
        "staff_7": 0
      })
    );
  }

  const savedTotal = localStorage.getItem("debit_total_percent");
  if (savedTotal) {
    const total = parseFloat(savedTotal);
    const toplamborc = document.getElementById("toplam_borc");
    toplamborc.textContent = total;
  }

  // 1. Tüm staff_ değerlerini al
  const values = JSON.parse(localStorage.getItem("values") || "{}");
  const staffEntries = Object.entries(values).filter(([key, val]) => key.startsWith('staff_'));
  // orijinal değerleri ve onların mutlak değer toplamını bul
  const absSum = staffEntries.reduce((sum, [k, v]) => sum + Math.abs(parseFloat(v)), 0);

  // 2. Oranları hesapla ve svg donut chart yarat
  let offset = 0;
  let circles = "";

  for (let i = 0; i < staffEntries.length; ++i) {
    const [k, v] = staffEntries[i];
    const val = parseFloat(v);

    // Tüm segment oranlarını mutlak değerle dağıtıyoruz
    let percent = absSum === 0 ? 0 : ((Math.abs(val) / absSum) * 100);
    let dasharray = percent.toFixed(2) + ", 100";
    let dashoffset = -offset; // eksiyle başlamalı
    let color = val >= 0
      ? STAFF_COLORS[i % STAFF_COLORS.length]
      : NEGATIVE_COLOR; // Negatif değerler kırmızı!

    if (percent > 0) {
      circles += `<circle
                cx="18" cy="18" r="15.9155" fill="none"
                stroke="${color}"
                stroke-width="2.5"
                stroke-dasharray="${dasharray}"
                stroke-dashoffset="${dashoffset}"
            ></circle>`;
    }
    offset += percent;
  }
  document.getElementById("donut-chart").innerHTML = circles;

  // 3. Orta toplam (TL)
  function tlFormat(val) {
    if (Math.abs(val) > 9999) {
      return (val < 0 ? "-₺" : "₺") + (Math.abs(val) / 1000).toFixed(1) + "K";
    }
    return (val < 0 ? "-₺" : "₺") + Math.abs(val).toLocaleString("tr-TR", { maximumFractionDigits: 2 });
  }
  const total = staffEntries.reduce((s, [k, v]) => s + parseFloat(v), 0);
  if (savedTotal) {
    document.getElementById("donut-total").textContent = tlFormat(total - savedTotal);
  } else {
    document.getElementById("donut-total").textContent = tlFormat(total);
  }

  // --- Başlangıç: Hedef/kalan hesaplaması ve progress güncelleme ---
  (function updateGoalProgress() {
    // format fonksiyonu (sayısal değeri TL biçimine çeviren mevcut fonksiyonunuzla uyumlu)
    function tlFormat(val) {
      if (isNaN(val)) return "₺0";
      if (Math.abs(val) > 9999) {
        return (val < 0 ? "-₺" : "₺") + (Math.abs(val) / 1000).toFixed(1) + "K";
      }
      return (val < 0 ? "-₺" : "₺") + Math.abs(val).toLocaleString("tr-TR", { maximumFractionDigits: 2 });
    }

    // daha güvenli string -> number parser (₺, . ve , ve K kısaltmasını da ele alır)
    function parseTL(str) {
      if (str == null) return NaN;
      let s = String(str).trim();
      if (s === "") return NaN;

      // Eğer "K" içeriyorsa örn "₺1.2K"
      const kMatch = s.match(/-?[\d\.,]+K/i);
      if (kMatch) {
        let num = kMatch[0].replace(/K/i, '').replace(/₺/g, '').trim();
        num = num.replace(/\./g, '').replace(',', '.'); // güvenli dönüştürme
        return parseFloat(num) * 1000;
      }

      // Temizleme: para sembollerini vs kaldır
      s = s.replace(/₺/g, '').replace(/\s/g, '');
      // Eğer hem nokta hem virgül varsa (tr formatı: bin ayracı . , ondalık ,) noktaları kaldır, virgülü noktayla değiştir
      if (s.indexOf('.') > -1 && s.indexOf(',') > -1) {
        s = s.replace(/\./g, '').replace(',', '.');
      } else if (s.indexOf(',') > -1 && s.indexOf('.') === -1) {
        s = s.replace(',', '.');
      } else {
        // sadece noktalar varsa (ör. 1000.50), bırak
      }
      // Son olarak sayısal olmayanları temizle
      s = s.replace(/[^0-9\.\-]/g, '');
      return parseFloat(s);
    }

    // DOM elemanları
    const donutTotalEl = document.getElementById("donut-total");
    const targetEl = document.getElementById("total_hedef");
    const kalanTLel = document.getElementById("kalan_hedef_tl");
    const kalanYuzdeEl = document.getElementById("kalan_hedef_yuzde");
    // progress çubuğunun iç div'ini al (ilk bulunan .bg-gradient-to-r kullanıldı)
    const progressInner = document.querySelector(".bg-gradient-to-r");

    if (!donutTotalEl || !targetEl || !kalanTLel || !kalanYuzdeEl || !progressInner) {
      // Gerekli elemanlardan biri yoksa çık
      return;
    }

    // Mevcut toplam değeri (ekrana yazılan değerden ya da script'te hesaplanan total/savedTotal farkından alma)
    // Eğer donutTotal zaten formatlanmış string ise parse et
    let current = parseTL(donutTotalEl.textContent);

    // Eğer current NaN ise (ör: script'ten variable 'total' kullanılabilir), deneyelim:
    if (isNaN(current)) {
      try {
        // total ve savedTotal değişkenleri aynı scope'ta varsa kullan
        if (typeof total !== "undefined") {
          const saved = (typeof savedTotal !== "undefined" && savedTotal !== null) ? parseFloat(savedTotal) : 0;
          current = isNaN(saved) ? total : (total - saved);
        }
      } catch (e) {
        current = NaN;
      }
    }

    const target = parseTL(targetEl.textContent);

    // Hesaplamalar
    const remaining = (isNaN(target) || isNaN(current)) ? NaN : (target - current);
    const percentReached = (isNaN(target) || target === 0 || isNaN(current)) ? 0 : (current / target) * 100;
    const percentForWidth = Math.max(0, Math.min(100, percentReached)); // görsel için 0-100 aralığı

    // Güncellemeler
    kalanTLel.textContent = isNaN(remaining) ? "₺0" : tlFormat(remaining);
    kalanYuzdeEl.textContent = (isNaN(percentReached) ? 0 : percentReached).toFixed(1) + "%";
    progressInner.style.width = percentForWidth.toFixed(1) + "%";

  })();
  // --- Bitiş ---

</script>

</html>