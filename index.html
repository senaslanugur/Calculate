<!DOCTYPE html>

<html class="dark" lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>My Wallet</title>
  <link rel="icon" type="image/x-icon" href="./icons.png">
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&amp;display=swap"
    rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.15/jquery.mask.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
  <!-- <script src="https://d3js.org/d3.v7.min.js""></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.js"
    integrity="sha512-iiZOijMkLFQSa43AyuzD6p176GJlnhWXEv7loEZFkCDpFQvZCijZLE6U8IRpAIb53KagIIwhSwHWTgsDlci/jw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#137fec",
            "background-light": "#f6f7f8",
            "background-dark": "#101922",
          },
          fontFamily: {
            "display": ["Inter", "sans-serif"]
          },
          borderRadius: {
            "DEFAULT": "0.25rem",
            "lg": "0.5rem",
            "xl": "0.75rem",
            "full": "9999px"
          },
        },
      },
    }
  </script>
  <style>
    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }
  </style>
</head>

<body>
  <div
    class="relative flex h-auto min-h-screen w-full flex-col bg-background-light dark:bg-background-dark group/design-root overflow-x-hidden font-display">
    <div class="layout-container flex h-full grow flex-col">
      <div class="px-4 md:px-10 flex flex-1 justify-center py-5">
        <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
          <header
            class="flex items-center justify-between whitespace-nowrap border-b border-solid border-gray-200 dark:border-b-[#283039] px-4 md:px-10 py-3">
            <div class="flex items-center gap-4 text-black dark:text-white">
              <div class="size-6">
                <span class="material-symbols-outlined">
                  wallet
                </span>
              </div>
              <h2 class="text-black dark:text-white text-xl font-bold leading-tight tracking-[-0.015em]">
                Hesaplarım</h2>
            </div>
            <div class="flex flex-1 justify-end gap-4">
              <button  onclick="location.href='./get_fon_info.html';"
                class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 w-10 bg-gray-200 dark:bg-[#283039] text-black dark:text-white gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0">
                <span class="material-symbols-outlined">
                  add_notes
                </span>
              </button>
              <button onclick="get_all_info()"
                class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 w-10 bg-gray-200 dark:bg-[#283039] text-black dark:text-white gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0">
                <span class="material-symbols-outlined">
                  notifications
                </span>
              </button>
              <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10"
                onclick="location.href='old.html';" data-alt="User avatar"
                style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCSZpcCc0dT1DhdDQKWT81EXGWi8rqUgI_SFnF_0Rh_YB0Qz5T5RW2IesH2nfPiSWZLHRYUthzsWMpwMWjCj1rRIBC3Pytm81Bh0zHG0LhevSnzTMcTnE32gr2EvkrGc2MBay3WSjRr3q-Uf3d6LfIMJupEKKwHyKIqurfwvF0vYemYGojnBvxEwsl2hRtUxSVNjXvT7vkgzsO4vCjEDyiC90b4V_F0MZvtJ5ivqDZu-slU3Dza1g4FGErpS9xOd8vorVv_75MEtEc6");'>
              </div>
            </div>
          </header>
          <main class="flex flex-col">
            <div class="flex items-center justify-center p-4">
              <div class="relative flex items-center justify-center w-52 h-52">
                <svg id="donut-chart" class="w-full h-full transform -rotate-90" viewBox="0 0 36 36"></svg>
                <div class="absolute flex flex-col items-center justify-center" id="donut-center">
                  <p class="text-zinc-600 dark:text-zinc-400 text-sm font-medium">Toplam Varlık</p>
                  <p id="donut-total" class="text-zinc-900 dark:text-white text-2xl font-bold tracking-tight">₺0</p>
                </div>
              </div>
            </div>
            <div class="flex min-w-[158px] flex-1 flex-col gap-2 rounded-xl p-4 bg-zinc-200/50 dark:bg-zinc-800/20">
              <p class="text-zinc-600 dark:text-zinc-400 text-sm font-medium leading-normal">Toplam Kâr/Zarar</p>
              <p class="text-green-500 tracking-tight text-2xl font-bold leading-tight" id="kar_zarar">%0.00</p>
            </div>
            <br>
            <div class="flex gap-4">
              <div class="flex-1 flex min-w-[158px] flex-col gap-2 rounded-xl p-4 bg-zinc-200/50 dark:bg-zinc-800/20">
                <p class="text-zinc-600 dark:text-zinc-400 text-sm font-medium leading-normal">Aylık Borç</p>
                <p class="text-red-500 tracking-tight text-2xl font-bold leading-tight" id="toplam_borc">₺0</p>
              </div>
              <div class="flex-1 flex min-w-[158px] flex-col gap-2 rounded-xl p-4 bg-zinc-200/50 dark:bg-zinc-800/20">
                <p class="text-zinc-600 dark:text-zinc-400 text-sm font-medium leading-normal">Aylık Gider</p>
                <p class="text-red-500 tracking-tight text-2xl font-bold leading-tight" id="toplam_harcama">₺0</p>
              </div>
            </div>
            <br>
            <div class="flex flex-col gap-4">
              <div
                class="flex flex-col gap-4 rounded-lg border border-gray-200 bg-background-light p-4 dark:border-[#283039] dark:bg-background-dark">
                <div class="flex w-full items-start justify-between">
                  <p class="line-clamp-1 text-base font-medium leading-normal text-black dark:text-white"
                    id="staff-1-name">Bank of America</p>
                </div>
                <div class="flex w-full flex-wrap items-center justify-between gap-4">
                  <div class="relative grow sm:max-w-xs">
                    <span
                      class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 text-base">
                      currency_lira </span>
                    <input
                      class="w-full rounded-md border-gray-300 bg-white py-2 pl-8 pr-2 text-sm text-black placeholder-gray-400 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-500"
                      placeholder="Amount" type="number" id="staff-1" />
                  </div>
                </div>
              </div>
              <div
                class="flex flex-col gap-4 rounded-lg border border-gray-200 bg-background-light p-4 dark:border-[#283039] dark:bg-background-dark">
                <div class="flex w-full items-start justify-between">
                  <p class="line-clamp-1 text-base font-medium leading-normal text-black dark:text-white"
                    id="staff-2-name">Bank of America</p>
                </div>
                <div class="flex w-full flex-wrap items-center justify-between gap-4">
                  <div class="relative grow sm:max-w-xs">
                    <span
                      class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 text-base">
                      currency_lira </span>
                    <input
                      class="w-full rounded-md border-gray-300 bg-white py-2 pl-8 pr-2 text-sm text-black placeholder-gray-400 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-500"
                      placeholder="Amount" type="number" id="staff-2" />
                  </div>
                </div>
              </div>
              <div
                class="flex flex-col gap-4 rounded-lg border border-gray-200 bg-background-light p-4 dark:border-[#283039] dark:bg-background-dark">
                <div class="flex w-full items-start justify-between">
                  <p class="line-clamp-1 text-base font-medium leading-normal text-black dark:text-white"
                    id="staff-3-name">Bank of America</p>
                </div>
                <div class="flex w-full flex-wrap items-center justify-between gap-4">
                  <div class="relative grow sm:max-w-xs">
                    <span
                      class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 text-base">
                      currency_lira </span>
                    <input
                      class="w-full rounded-md border-gray-300 bg-white py-2 pl-8 pr-2 text-sm text-black placeholder-gray-400 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-500"
                      placeholder="Amount" type="number" id="staff-3" />
                  </div>
                </div>
              </div>
              <div
                class="flex flex-col gap-4 rounded-lg border border-gray-200 bg-background-light p-4 dark:border-[#283039] dark:bg-background-dark">
                <div class="flex w-full items-start justify-between">
                  <p class="line-clamp-1 text-base font-medium leading-normal text-black dark:text-white"
                    id="staff-4-name">Bank of America</p>
                </div>
                <div class="flex w-full flex-wrap items-center justify-between gap-4">
                  <div class="relative grow sm:max-w-xs">
                    <span
                      class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 text-base">
                      currency_lira </span>
                    <input
                      class="w-full rounded-md border-gray-300 bg-white py-2 pl-8 pr-2 text-sm text-black placeholder-gray-400 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-500"
                      placeholder="Amount" type="number" id="staff-4" />
                  </div>
                </div>
              </div>
              <div
                class="flex flex-col gap-4 rounded-lg border border-gray-200 bg-background-light p-4 dark:border-[#283039] dark:bg-background-dark">
                <div class="flex w-full items-start justify-between">
                  <p class="line-clamp-1 text-base font-medium leading-normal text-black dark:text-white"
                    id="staff-5-name">Bank of America</p>
                </div>
                <div class="flex w-full flex-wrap items-center justify-between gap-4">
                  <div class="relative grow sm:max-w-xs">
                    <span
                      class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 text-base">
                      currency_lira </span>
                    <input
                      class="w-full rounded-md border-gray-300 bg-white py-2 pl-8 pr-2 text-sm text-black placeholder-gray-400 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-500"
                      placeholder="Amount" type="number" id="staff-5" />
                  </div>
                </div>
              </div>
              <div
                class="flex flex-col gap-4 rounded-lg border border-gray-200 bg-background-light p-4 dark:border-[#283039] dark:bg-background-dark">
                <div class="flex w-full items-start justify-between">
                  <p class="line-clamp-1 text-base font-medium leading-normal text-black dark:text-white"
                    id="staff-6-name">Bank of America</p>
                </div>
                <div class="flex w-full flex-wrap items-center justify-between gap-4">
                  <div class="relative grow sm:max-w-xs">
                    <span
                      class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 text-base">
                      currency_lira </span>
                    <input
                      class="w-full rounded-md border-gray-300 bg-white py-2 pl-8 pr-2 text-sm text-black placeholder-gray-400 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-500"
                      placeholder="Amount" type="number" id="staff-6" />
                  </div>
                </div>
              </div>
              <div
                class="flex flex-col gap-4 rounded-lg border border-gray-200 bg-background-light p-4 dark:border-[#283039] dark:bg-background-dark">
                <div class="flex w-full items-start justify-between">
                  <p class="line-clamp-1 text-base font-medium leading-normal text-black dark:text-white"
                    id="staff-7-name">Bank of America</p>
                </div>
                <div class="flex w-full flex-wrap items-center justify-between gap-4">
                  <div class="relative grow sm:max-w-xs">
                    <span
                      class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 text-base">
                      currency_lira </span>
                    <input
                      class="w-full rounded-md border-gray-300 bg-white py-2 pl-8 pr-2 text-sm text-black placeholder-gray-400 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-500"
                      placeholder="Amount" type="number" id="staff-7" />
                  </div>
                </div>
              </div>
            </div>
            <div
              class="mt-8 border-t border-gray-200 bg-background-light p-4 dark:border-[#283039] dark:bg-background-dark">
              <div id="chartContainer" style="height: 370px; width: 100%;"></div>
            </div>
          </main>
        </div>
      </div>
    </div>
  </div>
  <div
    class="sticky bottom-0 bg-white dark:bg-gray-800 shadow-[0_-2px_10px_rgba(0,0,0,0.05)] dark:shadow-[0_-2px_10px_rgba(0,0,0,0.2)] rounded-t-2xl px-6 py-3">
    <div class="flex justify-around items-start">
      <a class="text-center text-teal-500" href="#donut-total" onclick="calculate()">
        <span class="material-symbols-outlined text-3xl">calculate</span>
        <span class="text-xs font-semibold block">Calculate</span>
      </a>
      <a class="text-center text-gray-500 dark:text-gray-400" href="#chartContainer" onclick="lineGraph()">
        <span class="material-symbols-outlined text-3xl">finance_mode</span>
        <span class="text-xs font-semibold block">Daily Graph</span>
      </a>
      <a class="text-center text-gray-500 dark:text-gray-400" href="#chartContainer" onclick="barGraph()">
        <span class="material-symbols-outlined text-3xl">align_horizontal_center</span>
        <span class="text-xs font-semibold block">Distribution Graph</span>
      </a>
      <a class="text-center text-gray-500 dark:text-gray-400" href="./debit.html">
        <span class="material-symbols-outlined text-3xl">money_range</span>
        <span class="text-xs font-semibold block">Debt List</span>
      </a>
      <a class="text-center text-gray-500 dark:text-gray-400" href="./expenses.html">
        <span class="material-symbols-outlined text-3xl">payment_arrow_down</span>
        <span class="text-xs font-semibold block">Expenses List</span>
      </a>
      <!-- <a class="text-center text-gray-500 dark:text-gray-400" href="./get_fon_info.html">
        <span class="material-symbols-outlined text-3xl">add_notes</span>
        <span class="text-xs font-semibold block">Fund List</span>
      </a> -->

    </div>
  </div>
</body>
<script type="text/javascript" src="./script.js"></script>
<script type="text/javascript" src="./Line_Chart.js"></script>
<script type="text/javascript" src="./day_date_graph.js"></script>
<script type="text/javascript" src="./bar_graph.js"></script>

<!-- <script type="text/javascript" src="./fetch_data.js"></script>-->
<script>
  calculate()
  // lineGraph()
  const STAFF_COLORS = [
    "#3B82F6", // blue
    "#8B5CF6", // purple
    "#FACC15", // yellow
    "#F97316", // orange
    "#14B8A6"  // teal
  ];
  const NEGATIVE_COLOR = "#EF4444"; // Kırmızı!

  // Test amaçlı localStorage yoksa ekleyelim
  if (!localStorage.getItem("values")) {
    localStorage.setItem(
      "values",
      JSON.stringify({
        "staff_1": 103.8,
        "staff_2": 226.7,
        "staff_3": 54.2,
        "staff_4": 132.8,
        "staff_5": -33.7,
        "staff_6": -10.2,
        "staff_7": 0
      })
    );
  }

  const savedTotal = localStorage.getItem("debit_total_percent");
  if (savedTotal) {
    const total = parseFloat(savedTotal);
    const toplamborc = document.getElementById("toplam_borc");
    toplamborc.textContent = total;
  }

  // 1. Tüm staff_ değerlerini al
  const values = JSON.parse(localStorage.getItem("values") || "{}");
  const staffEntries = Object.entries(values).filter(([key, val]) => key.startsWith('staff_'));
  // orijinal değerleri ve onların mutlak değer toplamını bul
  const absSum = staffEntries.reduce((sum, [k, v]) => sum + Math.abs(parseFloat(v)), 0);

  // 2. Oranları hesapla ve svg donut chart yarat
  let offset = 0;
  let circles = "";

  for (let i = 0; i < staffEntries.length; ++i) {
    const [k, v] = staffEntries[i];
    const val = parseFloat(v);

    // Tüm segment oranlarını mutlak değerle dağıtıyoruz
    let percent = absSum === 0 ? 0 : ((Math.abs(val) / absSum) * 100);
    let dasharray = percent.toFixed(2) + ", 100";
    let dashoffset = -offset; // eksiyle başlamalı
    let color = val >= 0
      ? STAFF_COLORS[i % STAFF_COLORS.length]
      : NEGATIVE_COLOR; // Negatif değerler kırmızı!

    if (percent > 0) {
      circles += `<circle
                cx="18" cy="18" r="15.9155" fill="none"
                stroke="${color}"
                stroke-width="2.5"
                stroke-dasharray="${dasharray}"
                stroke-dashoffset="${dashoffset}"
            ></circle>`;
    }
    offset += percent;
  }
  document.getElementById("donut-chart").innerHTML = circles;

  // 3. Orta toplam (TL)
  function tlFormat(val) {
    if (Math.abs(val) > 9999) {
      return (val < 0 ? "-₺" : "₺") + (Math.abs(val) / 1000).toFixed(1) + "K";
    }
    return (val < 0 ? "-₺" : "₺") + Math.abs(val).toLocaleString("tr-TR", { maximumFractionDigits: 2 });
  }
  const total = staffEntries.reduce((s, [k, v]) => s + parseFloat(v), 0);
  if (savedTotal) {
    document.getElementById("donut-total").textContent = tlFormat(total - savedTotal);
  } else {
    document.getElementById("donut-total").textContent = tlFormat(total);
  }


</script>

</html>